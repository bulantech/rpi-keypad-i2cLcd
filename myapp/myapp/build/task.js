const config=require("config");let intervalMenu,timeoutMenu,pingTimeout,gState="init",gTag="",userId="",password="";const menuTimeoutCount=config.e("timeoutCount.menu"),fillTimeoutCount=config.e("timeoutCount.fill"),alertTimeoutCount=config.e("timeoutCount.alert"),skipTimeoutCount=config.e("timeoutCount.skip"),pingTimeoutCount=config.e("timeoutCount.ping"),showTimeCount=config.e("timeoutCount.show");let port,bathText="",litresText="",maintenanceMode=!1,blink=!1,price=99,priceText="",dateText="",timeText="",digiCount=0,setDate=!0,index=0,portOk=!1,serialReceiveCmd="";const cmd={t:":",a:";",i:"01",s:"02",n:"03",r:"04",c:"05",o:"06200",u:"08",l:"0A",m:"0B",d:"0C",k:"0D",T:"0E"},maintenanceMenu=["Set oil price","Set date time","Add users","Test control M/B","Ping control M/B","Tank volume","Flow K volume","Clear/reset","Reboot","Exit"];let menuCount=0;const users=config.e("test.users"),readyPing=config.e("readyPing"),skepSerialNotFound=config.e("skepSerialNotFound");let pricePerLiter=33.5,orderID=0,cmdFuelType="D";const LCD=require("raspberrypi-liquid-crystal"),lcd=new LCD(1,39,16,2),rfidInit=()=>{const e="/dev/input/event0";if(!require("fs").existsSync(e))return console.log(e,"not found"),1;const t=require("input-event"),a=new t(e),i=new t.f(a),s=[{b:"1",p:2},{b:"2",p:3},{b:"3",p:4},{b:"4",p:5},{b:"5",p:6},{b:"6",p:7},{b:"7",p:8},{b:"8",p:9},{b:"9",p:10},{b:"0",p:11}];let n="";i.M("keypress",(e=>{if(28==e.p)return console.log("tag =",n),gTag=n,n="",void("ready"===gState&&task("card-id"));const t=s.C((({p:t})=>t===e.p));n+=t.b}))},Gpio=require("onoff").Gpio,keypadR1=new Gpio(6,"out"),keypadR2=new Gpio(13,"out"),keypadR3=new Gpio(19,"out"),keypadR4=new Gpio(26,"out"),keypadC1=new Gpio(21,"in","falling",{y:10}),keypadC2=new Gpio(20,"in","falling",{y:10}),keypadC3=new Gpio(16,"in","falling",{y:10});let scanRow=0;const keys=[["1","2","3"],["4","5","6"],["7","8","9"],["*","0","#"]];let nowKey=null;const checkKey=e=>{let t="";if(255!==e)return t=keys[scanRow][e],void(nowKey||(nowKey=t));switch(t=nowKey,nowKey=null,console.log("KeyUp:",t,(new Date).getTime()),gState){case"ready":switch(t){case"*":return task("maintenance-to");case"#":return task("ready-show-date");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":return userId+=t,task("user-id")}break;case"ready-not-ping":switch(t){case"*":case"#":return task("init-rfid")}break;case"init-rfid":switch(t){case"*":return task("init-rfid");case"#":return task("init-serial")}break;case"init-serial":switch(t){case"*":return task("init-rfid");case"#":if(skepSerialNotFound)return task("ready")}break;case"card-id":switch(t){case"*":task("ready");break;case"#":if(users.C((e=>e.w===gTag)))return task("password");task("user-not-found")}break;case"user-id":switch(t){case"*":if(!userId.v)return task("ready");userId=userId.x(0,-1);break;case"#":{if(!userId.v)return;const e=users.C((e=>e.h===userId));return task(e?"password":"user-not-found")}case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":userId+=t}lcd.g(0,"User> "+userId.I(10," ")),userId.v?lcd.g(1,"CLEAR(*)   OK(#)"):lcd.g(1,"EXIT(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"password":switch(t){case"*":if(!password.v)return task("ready");password=password.x(0,-1);break;case"#":if(!password.v)return;return task("auth");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":password+=t}lcd.g(0,"Pass> "+password.I(10," ")),password.v?lcd.g(1,"CLEAR(*)   OK(#)"):lcd.g(1,"EXIT(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"validation-to":switch(t){case"*":return task("validation-process");case"#":return task("fill-select")}break;case"fill-select":switch(t){case"1":task("fill-bath-select");break;case"2":task("fill-litres-select");break;case"3":task("fill-full-confirm")}break;case"fill-full-confirm":switch(t){case"*":return task("fill-select");case"#":return task("fill-full")}break;case"fill-bath-select":switch(t){case"*":if(!bathText.v)return task("fill-select");bathText=bathText.x(0,-1);break;case"#":if(bathText.v)return task("fill-bath-confirm");break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":bathText.v<4&&(bathText+=t)}lcd.g(0,"Amount> "+bathText.I(8," ")),bathText.v?lcd.g(1,"CLEAR(*)   OK(#)"):lcd.g(1,"BACK(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"fill-bath-confirm":switch(t){case"*":return task("fill-select");case"#":return task("fill-bath")}break;case"fill-litres-select":switch(t){case"*":if(!litresText.v)return task("fill-select");litresText=litresText.x(0,-1);break;case"#":if(litresText.v)return task("fill-litres-confirm");break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":litresText.v<2&&(litresText+=t)}lcd.g(0,"Litres> "+litresText.I(8," ")),litresText.v?lcd.g(1,"CLEAR(*)   OK(#)"):lcd.g(1,"BACK(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"fill-litres-confirm":switch(t){case"*":return task("fill-select");case"#":return task("fill-litres")}break;case"fill-timeout":switch(t){case"*":case"#":return task("ready")}break;case"fill-complete":if("#"===t)return task("ready");break;case"maintenance-to":switch(t){case"*":return task("ready");case"#":return maintenanceMode=!0,task("password")}break;case"maintenance-menu":switch(t){case"*":++menuCount>=maintenanceMenu.v&&(menuCount=0);break;case"#":switch(maintenanceMenu[menuCount]){case"Set oil price":return task("Set-oil-price");case"Set date time":return task("Set-date-time");case"Add users":return task("Add users");case"Test control M/B":return task("Test-control-M/B");case"Ping control M/B":return task("Ping-control-M/B");case"Tank volume":return task("Tank-volume");case"Flow K volume":return task("Flow-K-volume");case"Clear/reset":return task("Clear/reset");case"Reboot":return task("Reboot");case"Exit":return task("ready")}}lcd.g(0,maintenanceMenu[menuCount].R(16," ")),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"Set-oil-price":switch(t){case"*":if(!priceText.v)return task("ready");priceText=priceText.x(0,-1);break;case"#":if(priceText.v)return price=1*priceText,console.log("price",price),task("done");break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":priceText.v<2&&(priceText+=t)}lcd.g(0,"Price/Litres> "+priceText.I(2," ")),priceText.v?lcd.g(1,"CLEAR(*)   OK(#)"):lcd.g(1,"EXIT(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"Reboot":switch(t){case"*":return task("maintenance-menu");case"#":console.log("Reboot"),lcd.g(0,"   Reboot now   "),lcd.g(1,"       ...      "),timeoutMenu=setTimeout((()=>{(0,require("child_process").exec)("sudo reboot",(function(e,t,a){console.log("Reboot:",e,t,a)}))}),1e3)}break;case"Set-date-time":switch(clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount),t){case"*":setDate?(setDate=!1,digiCount=0,index=0):(setDate=!0,digiCount=0,index=0);break;case"#":const e=dateText.K("/"),i=e[2]+"-"+e[1]+"-"+e[0]+" "+timeText;console.log("dateSet",i);var a=require("child_process").exec;return a("sudo timedatectl set-ntp false",(function(e,t,s){console.log("set-ntp false:",e,t,s),a('sudo timedatectl set-time "'+i+'"',(function(e,t,a){console.log("set-time:",e,t,a)}))})),task("done");case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":switch(digiCount){case 0:if(setDate){if(1*t>3)return}else if(1*t>2)return;break;case 1:if(setDate){if("3"===dateText[0]&&1*t>1)return}else if("2"===timeText[0]&&1*t>=4)return;break;case 2:if(setDate){if(1*t>1)return}else if(1*t>5)return;break;case 3:if(setDate&&"1"===dateText[3]&&1*t>2)return;break;case 4:if(setDate){if(1*t>2)return}else if(1*t>5)return}index=digiCount>3?digiCount+2:digiCount>1?digiCount+1:digiCount,setDate?(dateText=dateText.S(0,index)+t+dateText.S(index+1),++digiCount>7&&(digiCount=0)):(timeText=timeText.S(0,index)+t+timeText.S(index+1),++digiCount>5&&(digiCount=0)),index=index>3?digiCount+2:index>=1?digiCount+1:digiCount,digiCount||(index=0)}}},scanKeyInterval=()=>{setInterval((function(){for(scanRow=0;scanRow<4;scanRow++){switch(keypadR1.E(1),keypadR2.E(1),keypadR3.E(1),keypadR4.E(1),scanRow){case 0:keypadR1.E(0);break;case 1:keypadR2.E(0);break;case 2:keypadR3.E(0);break;case 3:keypadR4.E(0)}if(!keypadC1.D())return checkKey(0);if(!keypadC2.D())return checkKey(1);if(!keypadC3.D())return checkKey(2);if(nowKey)return checkKey(255)}}),100)},serialInit=()=>{const e="/dev/ttyUSB0";if(!require("fs").existsSync(e))return console.log(e,"not found"),1;if(portOk)return 0;const t=require("serialport");port=new t("/dev/ttyUSB0",{O:!0,P:9600,F:8,_:"none",A:1});const a=new t.B.L({v:1});return port.N(a),port.M("error",(function(e){console.log("Error: ",e.q)})),port.M("open",(function(){console.log("Port open"),portOk=!0})),port.M("close",(()=>{console.log("Serial port disconnected."),portOk=!1})),a.M("data",(e=>{serialReceive(e)})),0},serialTransmit=e=>{if(console.log("serialTransmit: cmd, state =>",e,gState),!portOk)return console.log("serialTransmit: !portOk",gState),serialInit();let t,a;switch(serialReceiveCmd="",e){case"check_status_PING":t=cmd.t+cmdFuelType+cmd.T+cmd.a;break;case"sale_by_member_debit_money":switch(a=(++orderID).G().I(4,"0"),gState){case"fill-full":t=cmd.t+cmdFuelType+cmd.m+"9999"+a+cmd.a;break;case"fill-bath":t=cmd.t+cmdFuelType+cmd.m+bathText.I(4,"0")+a+cmd.a;break;case"fill-litres":bathText=(Math.floor(litresText*pricePerLiter)+"").I(4,"0"),t=cmd.t+cmdFuelType+cmd.m+bathText.I(4,"0")+a+cmd.a}break;default:return void console.log("serialTransmit: gState not found =>",gState)}console.log("cmdNow =>",t),port.X(t)},serialReceive=e=>{const t=e.G();if(t===cmd.t)return serialReceiveCmd=":";if(serialReceiveCmd+=t,t===cmd.a){switch(console.log("serialReceiveCmd =>",serialReceiveCmd),gState){case"ready":clearTimeout(pingTimeout);break;case"fill-full":case"fill-bath":case"fill-litres":console.log("fill-full complete"),task("fill-complete")}serialReceiveCmd=""}},task=e=>{switch(console.log((new Date).getTime(),"task:",e),gState=e,e){case"init":lcd.U(),lcd.V(),setInterval((function(){for(scanRow=0;scanRow<4;scanRow++){switch(keypadR1.E(1),keypadR2.E(1),keypadR3.E(1),keypadR4.E(1),scanRow){case 0:keypadR1.E(0);break;case 1:keypadR2.E(0);break;case 2:keypadR3.E(0);break;case 3:keypadR4.E(0)}if(!keypadC1.D())return checkKey(0);if(!keypadC2.D())return checkKey(1);if(!keypadC3.D())return checkKey(2);if(nowKey)return checkKey(255)}}),100),lcd.g(0,"   Check RFID   "),lcd.g(1,"       ...      "),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("init-rfid")}),1e3*alertTimeoutCount);break;case"init-rfid":if(rfidInit())return lcd.g(0,"RFID Not Found  "),lcd.g(1,"CHECK(*) SKIP(#)"),clearTimeout(timeoutMenu),void(timeoutMenu=setTimeout((()=>{task("init-serial")}),1e3*skipTimeoutCount));lcd.g(0,"  Check Serial  "),lcd.g(1,"      ...       "),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("init-serial")}),1e3*alertTimeoutCount);break;case"init-serial":if(serialInit())return lcd.g(0,"Serial Not Found"),lcd.g(1,"    CHECK(*)    "),void clearTimeout(timeoutMenu);lcd.g(0,"     Ready      "),lcd.g(1,"      ...       "),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("ready")}),2e3);break;case"ready":password="",userId="",gTag="",maintenanceMode=!1,clearTimeout(timeoutMenu),readyPing&&(serialTransmit("check_status_PING"),clearTimeout(pingTimeout),pingTimeout=setTimeout((()=>{task("ready-not-ping")}),1e3*pingTimeoutCount));const e=new Date,t=e.H().G().I(2,"0")+"/"+(e.Y()+1).G().I(2,"0")+"   "+e.j().G().I(2,"0")+":"+e.z().G().I(2,"0")+":"+e.J().G().I(2,"0");lcd.g(0,t),lcd.g(1," Key in or Tap  "),clearInterval(intervalMenu),intervalMenu=setInterval((()=>{const e=new Date,t=e.H().G().I(2,"0")+"/"+(e.Y()+1).G().I(2,"0")+"   "+e.j().G().I(2,"0")+":"+e.z().G().I(2,"0")+":"+e.J().G().I(2,"0");lcd.g(0,t),lcd.g(1," Key in or Tap  ")}),1e3);break;case"ready-not-ping":clearInterval(intervalMenu),lcd.g(0," M/B not found  "),lcd.g(1,"    CHECK(*)    ");break;case"ready-show-date":{const e=new Date,t=e.H().G().I(2,"0")+"/"+(e.Y()+1).G().I(2,"0")+"/"+e.Q().G(),a=e.j().G().I(2,"0")+":"+e.z().G().I(2,"0")+":"+e.J().G().I(2,"0");lcd.g(0,"   "+t.R(16," ")),lcd.g(1,"    "+a.R(16," ")),clearInterval(intervalMenu),intervalMenu=setInterval((()=>{const e=new Date,t=e.H().G().I(2,"0")+"/"+(e.Y()+1).G().I(2,"0")+"/"+e.Q().G(),a=e.j().G().I(2,"0")+":"+e.z().G().I(2,"0")+":"+e.J().G().I(2,"0");lcd.g(0,"   "+t.R(16," ")),lcd.g(1,"    "+a.R(16," "))}),1e3),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("ready")}),1e3*showTimeCount)}break;case"card-id":clearInterval(intervalMenu),lcd.g(0,"Card> "+gTag),lcd.g(1,"EXIT(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"user-id":clearInterval(intervalMenu),lcd.g(0,"User> "+userId.I(10," ")),lcd.g(1,"CLEAR(*)   OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"user-not-found":clearInterval(intervalMenu),lcd.g(0," User not found "),lcd.g(1,"      ...       "),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("ready")}),2e3);break;case"password":clearInterval(intervalMenu),lcd.g(0,"Pass>           "),lcd.g(1,"EXIT(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"timeout":clearInterval(intervalMenu),lcd.g(0,"   Out of time  "),lcd.g(1,"      ...       "),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("ready")}),2e3);break;case"auth":clearInterval(intervalMenu);let a=null;if(gTag?a=users.C((e=>e.w===gTag&&e.W===password)):userId?a=users.C((e=>e.h===userId&&e.W===password)):maintenanceMode&&(a=users.C((e=>!0===e.Z&&e.W===password))),!a)return lcd.g(0,"   Password     "),lcd.g(1,"  incorrect!    "),clearTimeout(timeoutMenu),void setTimeout((()=>{task("ready")}),2e3);if(maintenanceMode)return task("maintenance-menu");task("validation-to");break;case"validation-to":lcd.g(0,"   Validation?  "),lcd.g(1,"OK(*)    SKIP(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"validation-process":lcd.g(0,"   Validation   "),lcd.g(1,">>  Process   <<"),intervalMenu=setInterval((()=>{blink?(blink=!1,lcd.g(1,">>  Process   <<")):(blink=!0,lcd.g(1," >> Process  << "))}),1e3),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"fill-select":lcd.g(0,"   How to pay?  "),lcd.g(1,"B(1)  L(2)  F(3)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"fill-full-confirm":lcd.g(0," Fill to full?  "),lcd.g(1,"NO(*)     YES(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"fill-full":lcd.g(0,"  Fill to full  "),lcd.g(1,">>  Process   <<"),serialTransmit("sale_by_member_debit_money"),intervalMenu=setInterval((()=>{blink?(blink=!1,lcd.g(1,">>  Process   <<")):(blink=!0,lcd.g(1," >> Process  << "))}),1e3),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("fill-complete")}),1e3*fillTimeoutCount);break;case"fill-bath-select":bathText="",lcd.g(0,"Amount> "+bathText.I(8," ")),lcd.g(1,"BACK(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"fill-bath-confirm":clearInterval(intervalMenu),lcd.g(0,"Fill "+bathText.I(4," ")+" Bath? "),lcd.g(1,"NO(*)     YES(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"fill-bath":lcd.g(0," Fill "+bathText.I(4," ")+" Bath "),lcd.g(1,">>  Process   <<"),serialTransmit("sale_by_member_debit_money"),intervalMenu=setInterval((()=>{blink?(blink=!1,lcd.g(1,">>  Process   <<")):(blink=!0,lcd.g(1," >> Process  << "))}),1e3),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("fill-timeout")}),1e3*fillTimeoutCount);break;case"fill-litres-select":bathText="",litresText="",lcd.g(0,"Litres> "+litresText.I(8," ")),lcd.g(1,"BACK(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"fill-litres-confirm":clearInterval(intervalMenu),lcd.g(0,"Fill "+litresText.I(3," ")+" Litres?"),lcd.g(1,"NO(*)     YES(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"fill-litres":lcd.g(0,"Fill "+litresText.I(3," ")+" Litres "),lcd.g(1,">>  Process   <<"),serialTransmit("sale_by_member_debit_money"),intervalMenu=setInterval((()=>{blink?(blink=!1,lcd.g(1,">>  Process   <<")):(blink=!0,lcd.g(1," >> Process  << "))}),1e3),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("fill-timeout")}),1e3*fillTimeoutCount);break;case"fill-timeout":clearInterval(intervalMenu),lcd.g(0,"  Fill Timeout  "),lcd.g(1,"RESET(*) SKIP(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("ready")}),1e3*menuTimeoutCount);break;case"fill-complete":clearInterval(intervalMenu),lcd.g(0," Fill complete  "),lcd.g(1,"                "),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("ready")}),1e3*alertTimeoutCount);break;case"done":clearInterval(intervalMenu),lcd.g(0,"      Done      "),lcd.g(1,"                "),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("ready")}),1e3*alertTimeoutCount);break;case"maintenance-to":clearInterval(intervalMenu),lcd.g(0,"To Maintenance? "),lcd.g(1,"EXIT(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"maintenance-menu":menuCount=0,lcd.g(0,maintenanceMenu[menuCount].R(16," ")),lcd.g(1,"NEXT(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"Reboot":clearInterval(intervalMenu),lcd.g(0," Reboot Machine?"),lcd.g(1,"NO(*)     YES(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"Set-oil-price":priceText=price+"",clearInterval(intervalMenu),lcd.g(0,"Price/Litres> "+priceText.I(2," ")),priceText.v?lcd.g(1,"CLEAR(*)   OK(#)"):lcd.g(1,"EXIT(*)    OK(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount);break;case"Set-date-time":setDate=!0,digiCount=0,index=0,dateText="",timeText="";const i=new Date;dateText=i.H().G().I(2,"0")+"/"+(i.Y()+1).G().I(2,"0")+"/"+i.Q().G(),timeText=i.j().G().I(2,"0")+":"+i.z().G().I(2,"0")+":"+i.J().G().I(2,"0"),lcd.g(0,"DATE> "+dateText),lcd.g(1,"TIME(*)  SAVE(#)"),clearTimeout(timeoutMenu),timeoutMenu=setTimeout((()=>{task("timeout")}),1e3*menuTimeoutCount),clearInterval(intervalMenu),intervalMenu=setInterval((()=>{let e="";setDate?(blink?(e=dateText.S(0,index)+"_"+dateText.S(index+1),blink=!1):(e=dateText,blink=!0),lcd.g(0,"DATE> "+e),lcd.g(1,"TIME(*)  SAVE(#)")):(blink?(e=timeText.S(0,index)+"_"+timeText.S(index+1),blink=!1):(e=timeText,blink=!0),lcd.g(0,"TIME>   "+e),lcd.g(1,"DATE(*)  SAVE(#)"))}),500)}};task("init");